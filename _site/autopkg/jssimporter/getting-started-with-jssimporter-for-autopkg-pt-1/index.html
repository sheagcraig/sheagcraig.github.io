<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Getting started with JSSImporter for AutoPkg: Pt 1 &#8211; Taco Destroyer</title>
<meta name="description" content="Many Mac admins have been relying more and more on AutoPkg to help automate the task of keeping software up to date. I know personally that it was an excellent addition to our school’s software update workflow, which was based around Munki for deployment, and InstaDMG for building install images.

">
<meta name="keywords" content="">

  

<!-- Twitter Cards -->
<meta name="twitter:title" content="Getting started with JSSImporter for AutoPkg: Pt 1">
<meta name="twitter:description" content="Many Mac admins have been relying more and more on AutoPkg to help automate the task of keeping software up to date. I know personally that it was an excellent addition to our school’s software update workflow, which was based around Munki for deployment, and InstaDMG for building install images.

">



<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://localhost:4000/images/site-logo.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Getting started with JSSImporter for AutoPkg: Pt 1">
<meta property="og:description" content="Many Mac admins have been relying more and more on AutoPkg to help automate the task of keeping software up to date. I know personally that it was an excellent addition to our school’s software update workflow, which was based around Munki for deployment, and InstaDMG for building install images.

">
<meta property="og:url" content="http://localhost:4000/autopkg/jssimporter/getting-started-with-jssimporter-for-autopkg-pt-1/">
<meta property="og:site_name" content="Taco Destroyer">





<link rel="canonical" href="http://localhost:4000/autopkg/jssimporter/getting-started-with-jssimporter-for-autopkg-pt-1/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Taco Destroyer Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		        
		    
		    <li><a href="http://localhost:4000/about/" >About</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/articles/" >Articles</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/blog/" >Blog</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/theme-setup/" >Theme Setup</a></li>
		  
		    
		        
		        
		    <li><a href="http://mademistakes.com" target="_blank">Made Mistakes</a></li>
		  
		    
		        
		    
		    <li><a href="http://localhost:4000/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
  		<a href="http://localhost:4000/" class="site-logo" rel="home" title="Taco Destroyer"><img src="http://localhost:4000/images/site-logo.png" width="200" height="200" alt="Taco Destroyer logo" class="animated fadeInDown"></a>
      
      <h1 class="site-title animated fadeIn"><a href="http://localhost:4000/">Taco Destroyer</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Describe your website here.</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"></span>
        
          <h1 class="entry-title">Getting started with JSSImporter for AutoPkg: Pt 1</h1>
        
      </header>
      <footer class="entry-meta">
        
          
        
        <span class="author vcard">By <span class="fn"></span></span>
        <span class="entry-date date published"><time datetime="2014-12-10T14:28:49-05:00"><i class="fa fa-calendar-o"></i> December 10, 2014</time></span>
        
        
        
        
      </footer>
      <div class="entry-content">
        <p>Many Mac admins have been relying more and more on AutoPkg to help automate the task of keeping software up to date. I know personally that it was an excellent addition to our school’s software update workflow, which was based around Munki for deployment, and InstaDMG for building install images.</p>

<p>But times change, and our school switched to using the Casper Suite to manage our fleet, and dropped Munki. Suddenly I had to start manually moving packages around and clicky-clicky-creating a ton of policies. This made me sad.</p>

<p><a href="http://labs.da.org/wordpress/sheagcraig/files/2014/12/tears.jpg"><img src="http://labs.da.org/wordpress/sheagcraig/files/2014/12/tears-300x220.jpg" alt="tears" /></a></p>

<p>Google Image search “sad” some time. You won’t be disappointed.</p>

<p>Fortunately, a brilliant guy named Allister worked through the mountain of details required to make it a possibility to upload AutoPkg’ed products to a JSS through it’s API, as well as create policies. This was enough to get me off my butt and start working on modifying his jss-autopkg-addon to meet our organization’s needs. This led in a multitude of directions; I created a python wrapper around the entire set of API features (as well as some non-API features) and refactored and rewrote Allister’s original work into something that was much more flexible, albeit <em>way</em> more complicated to set up.</p>

<p>So that’s where this series of blog posts fits in. I’m going to detail the process of setting up the JSSImporter and crafting recipes that meet some different workflow demands. Obviously, you’ll need a working installation of AutoPkg first, and it wouldn’t hurt to have a test JSS set up to practice with prior to rolling things out for production purposes. Really, the primary role of AutoPkg and JSSImporter for us is to provide a means for keeping our testers stocked with the latest software, so some instability is always expected anyway. While it’s certainly possible to pump packages straight into your production pipeline, in general, this is just to populate the testing environment with the latest and greatest, and thus is probably not mission-critical. So experimentation is good!</p>

<p>Our first order of business, then, is to grab the <a href="https://github.com/sheagcraig/JSSImporter/releases">latest JSSImporter installer package</a> and install it. You don’t need to fool around with git or anything; just grab the package. <em>Don’t</em> Google Image search “grab the package”.</p>

<p>In this, first installment, we’re just going to configure JSSImporter and use the recipes I’ve put into my jss-recipes repo. We will talk about how to write our own recipes, handle problem packages, and plan and customize our deployment workflow, in future posts.</p>

<p>The first thing we need to do is provide some information to JSSImporter about the JSS and how to access it, and what resources it has available. If you’ve configured AutoPkg, you should be familiar with how to do this. We are going to add the following keys to our com.github.autopkg.plist file:</p>

<ul>
  <li>
    <p>JSS_URL</p>
  </li>
  <li>
    <p>API_USERNAME</p>
  </li>
  <li>
    <p>API_PASSWORD</p>
  </li>
</ul>

<p>First, you should create an account on your JSS that will be used for API access, probably even just for AutoPkg. It will need “Create”, “Read”, and “Update” privileges on</p>

<ul>
  <li>
    <p>Categories</p>
  </li>
  <li>
    <p>Computer Groups</p>
  </li>
  <li>
    <p>Distribution Points</p>
  </li>
  <li>
    <p>Extension Attributes</p>
  </li>
  <li>
    <p>Packages</p>
  </li>
  <li>
    <p>Policies</p>
  </li>
  <li>
    <p>Scripts</p>
  </li>
</ul>

<p>To add the keys to your AutoPkg prefs:</p>

<pre><code>defaults write com.github.autopkg JSS_URL https://test.jss.org:8443
defaults write com.github.autopkg API_USERNAME apiUser
defaults write com.github.autopkg API_PASSWORD apiPassword
</code></pre>

<p>Substitute your information for the final values above. The URL needs to be complete–include the protocol and the port!</p>

<p>The next part is the tricky one: adding in your distribution points. And it’s tricky only in the sense that you either need to hand-edit some XML or you need to use the esoteric “plistbuddy”. Since we’re going to be writing recipes later, it makes sense to not avoid typing any XML and just edit the darn thing. There’s one caveat here though-don’t forget that on contemporary OS X systems, if you edit a preference file (i.e. .plist) the settings don’t take effect until the preferences system syncs. This can lead to some mystifying issues, so get in the habit of doing a <code>defaults read com.github.autopkg</code> each time you edit the preferences.</p>

<p>Fire up vim or I suppose some other text editor and add a section to ~/Library/Preferences/com.github.autopkg.plist that looks like this:</p>

<pre><code>	&lt;key&gt;JSS_REPOS&lt;/key&gt;
	&lt;array&gt;
	&lt;/array&gt;
</code></pre>

<p>Now, for each distribution point you would like to have AutoPkg and JSSImporter upload to, you need to add a dict of values. Each Casper setup is different, so take a look at <a href="https://github.com/sheagcraig/JSSImporter/blob/master/README.md#adding-distribution-points">the README</a> for detailed information on each type. For demonstration purposes, I’ll just configure a single AFP distribution point.</p>

<p>The documentation lets me know that using the auto-discovery for AFP/SMB shares, I only need a name and password (for the Read/Write enabled user on the share) for an AFP share. My preferences file should now have this section:</p>

<pre><code>    &lt;key&gt;JSS_REPOS&lt;/key&gt;
    &lt;array&gt;
        &lt;dict&gt;
            &lt;key&gt;name&lt;/key&gt;
            &lt;string&gt;USRepository&lt;/string&gt;
            &lt;key&gt;password&lt;/key&gt;
            &lt;string&gt;abc123&lt;/string&gt;
        &lt;/dict&gt;
    &lt;/array&gt;
</code></pre>

<p>And that’s all I need to get started. Again, check the README for details on setting up your JDS, or issues regarding multiple DP’s, etc.</p>

<p>Next, we’ll use autopkg’s command line to add in my jss-recipes:</p>

<pre><code>autopkg repo-add https://github.com/sheagcraig/jss-recipes
</code></pre>

<p>You can now run any of these recipes with autopkg run. e.g.</p>

<pre><code>autopkg run Evernote.jss
</code></pre>

<p>But what does it do?</p>

<p>My recipes are based around the idea of making packages for testing available to a subset of computers on campus. At a somewhat abstract level, what happens is that the JSSImporter processor will take the package spit out by the standard Evernote.pkg recipe and then try to set up all of the pieces of the puzzle needed to distribute it to testing computers.</p>

<p>First it ensures that the categories exist for the package and for the policy, creating them if they’re missing, and just leaving them alone otherwise. The Evernote recipe will ensure “Productivity” for the package, and “Testing” for the policy.</p>

<p>Next, the JSSImporter ensures an object representing our package exists on the API. Again, I say “ensure” rather than “creates”, as it will try to reuse an existing package object rather than make a new one so that you don’t get your JSS all crudded up with duplicates.</p>

<p>Once there is a package object, the JSSImporter will upload the package to every configured distribution point or distribution server. This process can take quite long, especially for some of the giant Apple packages like Logic or GarageBand. In our case, the package will be uploaded as “Evernote-6.0.3.pkg”, with a category of “Productivity”.</p>

<p>The next step is the JSSImporter will ensure that any needed extension attributes are present. (None are needed for Evernote).</p>

<p>So far, so good. Next, groups are handled. Again, JSSImporter ensures that they exist. My recipes all create a smart group for each product. For most of them, the smart group criteria is looking to find computers which are members of the static group “Testing” (which is how I specify which computers are “Testing” computers), and have the “Application Title” in question, with an “Application Version” which does not match the one for our package. Note that this is not the same thing as “older than” or “with a lesser version number”, as there’s no way to do that without extension attributes (maybe I’ll cover how to handle that later!). So in our example, the Evernote recipe will ensure an up-to-date smart group named “Evernote-update-smart” is present, with criteria of “Application Title” of “Evernote.app”, “Application Version” “is not” “6.0.3”, and is a “member of” the computer group “Testing”.</p>

<p>Said another way, our policy will be available to all computers which I have manually placed into the “Testing” group, with any Evernote version that does not match the one I am uploading.</p>

<p>Next, the JSSImporter ensures that any scripts needed for installation are available on the JSS. None are needed for Evernote, but some products need a pre-install or post-install script to make sure everything works correctly.</p>

<p>The policy is handled next. The important details for the policies are that they are scoped to the “Evernote-update-smart” group as expected. They are “enabled” immediately. They have a “category” of “Testing” so they are all grouped together in Self Service and in the JSS-&gt;Policies page. They are triggered through Self-Service only (meaning not at Check-In, Logout, etc). And finally, they are set to the “frequency” of “ongoing”. However, they have a final “maintenance” step of running a recon, so if everything installed correctly, the recon will pop them out of the smart group, and the user can’t install a second time. (The “ongoing” frequency allows us to update this policy when the <em>next</em> Evernote update comes out, and the user can again install without us having to go and “Flush” the policy logs like we would with a “Once per Computer” frequency. The goal is to be as hands-off as possible).</p>

<p>Finally, the JSSImporter makes sure that an icon file is available for the Self Service policy to display.</p>

<p><a href="http://labs.da.org/wordpress/sheagcraig/files/2014/12/Screen-Shot-2014-12-10-at-2.07.15-PM.png"><img src="http://labs.da.org/wordpress/sheagcraig/files/2014/12/Screen-Shot-2014-12-10-at-2.07.15-PM.png" alt="Screen Shot 2014-12-10 at 2.07.15 PM" /></a></p>

<p>A user with a computer in the “Testing” group can thus open up Self-Service, authenticate, and pop the “install” button on the Testing-&gt;”Install Latest Evernote” button. The slick thing is that the Install Evernote option will only appear to a computer that doesn’t already have that version. Once Self-Service downloads and installs the policy, a recon is run which will discover the newer version of Evernote, and the computer will fall out of the “Evernote-update-smart” group until the next update comes out.</p>

<p>Since there can be a lag between when we post updates, and the latest recon on a computer, I provide a self-service policy to my testers that will trigger a recon, after which all currently available updates should be available.</p>

<p>That concludes the first installment. Next, we’ll look at adapting an already working package recipe to the workflow outlined above and creating a JSS recipe.</p>

<p>If you’re really really into Python, here’s a fresh python-print blazer from Roberto Cavelli:</p>

<p><a href="http://labs.da.org/wordpress/sheagcraig/files/2014/12/pythonBlazer.jpg"><img src="http://labs.da.org/wordpress/sheagcraig/files/2014/12/pythonBlazer.jpg" alt="pythonBlazer" /></a></p>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://localhost:4000/jssimporter/python-jss/zipping-non-flat-packages-for-casper/" class="btn" title="Zipping Non-Flat Packages For Casper">Previous</a>
      
      
        <a href="http://localhost:4000/python-jss/solving-problems-with-python-jss-finding-the-printers-in-the-policies/" class="btn" title="Solving Problems With python-jss: Finding the Printers in the Policies">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2015 Your Name. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/" rel="nofollow">So Simple Theme</a>.</span>
<div class="social-icons">
	
	
	
	
	
	
	
	
	
  
	
  <a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://localhost:4000';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>




</body>
</html>
